name: webai

services:
  web-ai:
    container_name: browser-web-ai
    build:
      context: https://github.com/AndreiMarhatau/web-ai.git#main
      dockerfile: Dockerfile
      args:
        TARGETPLATFORM: ${TARGETPLATFORM:-linux/amd64}
    ports:
      - "${WEB_AI_PORT:-7790}:7790"
      - "${VNC_HTTP_PORT:-6180}:6180"
      - "${VNC_TCP_PORT:-5902}:5902"
      - "9223:9223"
    env_file:
      - .env
    environment:
      DISPLAY: ${DISPLAY:-:99}
      RESOLUTION: ${RESOLUTION:-1920x1080x24}
      VNC_TCP_PORT: ${VNC_TCP_PORT:-5902}
      VNC_HTTP_PORT: ${VNC_HTTP_PORT:-6180}
    volumes:
      - webai_data:/app/data
    restart: unless-stopped
    shm_size: "2g"
    cap_add:
      - SYS_ADMIN
    tmpfs:
      - /tmp
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "5902"]
      interval: 15s
      timeout: 5s
      retries: 5

volumes:
  webai_data:
